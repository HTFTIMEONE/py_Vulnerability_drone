#coding:utf-8
from flask import Flask
from flask import request,render_template,request
import pymysql
pymysql.install_as_MySQLdb()
from flask_sqlalchemy import SQLAlchemy

app = Flask(__name__)
app.config['SQLALCHEMY_DATABASE_URI'] = 'mysql://pychon:wsljx123@10.211.55.3:3306/pychon'
db = SQLAlchemy(app)
@app.route("/login",methods=['POST'])
def loginin():
    username = request.form['username']
    sql = "select * from users where username=:username"
    result = db.session.execute(sql,{"username":username})
    print(result.fetchall())
    return request.form['username']

@app.route("/reister",methods=['GET'])
def zhuce1():
    return render_template('register.html')
@app.route("/reister",methods=['POST'])
def zhuce():
    username = request.form['username']
    password = request.form['password']
    email = request.form['email']
    phone = request.form['phone']
    name = request.form['name']
    sql1 = "select * from newuser where username=:username"
    sql2 = "insert into newuser(username,password,email,phone,name) values(:username,:password,:email,:phone,:name)"
    result = db.session.execute(sql1,{"username":username})
    if len(result.fetchall()) > 0:
        return "该用户已经被注册"
    else:
        result = db.session.execute(sql2,{"username":username,"password":password,"email":email,"phone":phone,"name":name})
        if result:
            return "注册成功"
        else:
            return "注册失败"

app.run(host='127.0.0.1', port=666, debug='True')